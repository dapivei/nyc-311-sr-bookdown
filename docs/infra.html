<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 3 Data Pipeline e Infraestructura de AWS | NYC 311 Service Request Data Product</title>
  <meta name="description" content="Descripción de la implementación de un producto de datos: predicciones sobre el flujo de quejas diarias (por encima), del flujo promedio de quejas." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 3 Data Pipeline e Infraestructura de AWS | NYC 311 Service Request Data Product" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Descripción de la implementación de un producto de datos: predicciones sobre el flujo de quejas diarias (por encima), del flujo promedio de quejas." />
  <meta name="github-repo" content="https://github.com/dapivei/prueba" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 3 Data Pipeline e Infraestructura de AWS | NYC 311 Service Request Data Product" />
  
  <meta name="twitter:description" content="Descripción de la implementación de un producto de datos: predicciones sobre el flujo de quejas diarias (por encima), del flujo promedio de quejas." />
  

<meta name="author" content="Cadavid-Sánchez Sebastián, Herrera Musi Juan Pablo, Paz Cendejas Francisco, Villa Lizárraga Diego M. &amp; Pinto Veizaga Daniela" />


<meta name="date" content="2020-04-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dataset.html"/>
<link rel="next" href="governanza.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">NYC311ServiceRequest</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#descripción-del-problema"><i class="fa fa-check"></i><b>1.1</b> Descripción del Problema</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#objetivos-del-producto-de-datos"><i class="fa fa-check"></i><b>1.2</b> Objetivos del producto de datos</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#objetivo-generales"><i class="fa fa-check"></i><b>1.2.1</b> Objetivo generales</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#objetivos-específicos"><i class="fa fa-check"></i><b>1.2.2</b> Objetivos específicos</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#predicción"><i class="fa fa-check"></i><b>1.3</b> Predicción</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#población-objetivo"><i class="fa fa-check"></i><b>1.4</b> Población objetivo</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dataset.html"><a href="dataset.html"><i class="fa fa-check"></i><b>2</b> Set de datos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="dataset.html"><a href="dataset.html#frecuencia-de-actualización-de-datos"><i class="fa fa-check"></i><b>2.1</b> Frecuencia de actualización de datos</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="infra.html"><a href="infra.html"><i class="fa fa-check"></i><b>3</b> Data Pipeline e Infraestructura de AWS</a>
<ul>
<li class="chapter" data-level="3.1" data-path="infra.html"><a href="infra.html#data-pipeline"><i class="fa fa-check"></i><b>3.1</b> Data Pipeline</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="infra.html"><a href="infra.html#deployment"><i class="fa fa-check"></i><b>3.1.1</b> Deployment</a></li>
<li class="chapter" data-level="3.1.2" data-path="infra.html"><a href="infra.html#desarrollo"><i class="fa fa-check"></i><b>3.1.2</b> Desarrollo</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="infra.html"><a href="infra.html#infraestructura-aws"><i class="fa fa-check"></i><b>3.2</b> Infraestructura AWS</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="infra.html"><a href="infra.html#configuración-del-bastión"><i class="fa fa-check"></i><b>3.2.1</b> Configuración del bastión</a></li>
<li class="chapter" data-level="3.2.2" data-path="infra.html"><a href="infra.html#addus.sh"><i class="fa fa-check"></i><b>3.2.2</b> addus.sh</a></li>
<li class="chapter" data-level="3.2.3" data-path="infra.html"><a href="infra.html#agregar-llaves-para-conexión"><i class="fa fa-check"></i><b>3.2.3</b> Agregar llaves para conexión</a></li>
<li class="chapter" data-level="3.2.4" data-path="infra.html"><a href="infra.html#ec2-procesamiento"><i class="fa fa-check"></i><b>3.2.4</b> EC2 procesamiento</a></li>
<li class="chapter" data-level="3.2.5" data-path="infra.html"><a href="infra.html#para-levantar-cluster"><i class="fa fa-check"></i><b>3.2.5</b> Para levantar cluster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="governanza.html"><a href="governanza.html"><i class="fa fa-check"></i><b>4</b> Governanza de Datos</a>
<ul>
<li class="chapter" data-level="4.1" data-path="governanza.html"><a href="governanza.html#linaje-de-datos-metadatos-y-diseño-de-tablasrds-para-la-fase-del-extract-load-and-transformetl"><i class="fa fa-check"></i><b>4.1</b> Linaje de Datos: Metadatos y Diseño de Tablas(RDS) para la fase del <em>Extract, Load and Transform(ETL)</em></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="governanza.html"><a href="governanza.html#raw"><i class="fa fa-check"></i><b>4.1.1</b> Raw</a></li>
<li class="chapter" data-level="4.1.2" data-path="governanza.html"><a href="governanza.html#preprocessed"><i class="fa fa-check"></i><b>4.1.2</b> Preprocessed</a></li>
<li class="chapter" data-level="4.1.3" data-path="governanza.html"><a href="governanza.html#clean"><i class="fa fa-check"></i><b>4.1.3</b> Clean</a></li>
<li class="chapter" data-level="4.1.4" data-path="governanza.html"><a href="governanza.html#semantic"><i class="fa fa-check"></i><b>4.1.4</b> Semantic</a></li>
<li class="chapter" data-level="4.1.5" data-path="governanza.html"><a href="governanza.html#ml-preprocessing"><i class="fa fa-check"></i><b>4.1.5</b> ML preprocessing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>5</b> Exploratory Data Analysis (EDA)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="eda.html"><a href="eda.html#hallazgos"><i class="fa fa-check"></i><b>5.1</b> Hallazgos</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="eda.html"><a href="eda.html#estructura-inicial"><i class="fa fa-check"></i><b>5.1.1</b> Estructura Inicial</a></li>
<li class="chapter" data-level="5.1.2" data-path="eda.html"><a href="eda.html#valores-nulos"><i class="fa fa-check"></i><b>5.1.2</b> Valores nulos</a></li>
<li class="chapter" data-level="5.1.3" data-path="eda.html"><a href="eda.html#registros-con-mayúsculas-y-minúsculas"><i class="fa fa-check"></i><b>5.1.3</b> Registros con mayúsculas y minúsculas</a></li>
<li class="chapter" data-level="5.1.4" data-path="eda.html"><a href="eda.html#valores-únicos"><i class="fa fa-check"></i><b>5.1.4</b> Valores únicos</a></li>
<li class="chapter" data-level="5.1.5" data-path="eda.html"><a href="eda.html#quejas-según-su-estatus"><i class="fa fa-check"></i><b>5.1.5</b> Quejas según su estatus</a></li>
<li class="chapter" data-level="5.1.6" data-path="eda.html"><a href="eda.html#quejas-según-municipio"><i class="fa fa-check"></i><b>5.1.6</b> Quejas según municipio</a></li>
<li class="chapter" data-level="5.1.7" data-path="eda.html"><a href="eda.html#quejas-según-agencia"><i class="fa fa-check"></i><b>5.1.7</b> Quejas según agencia</a></li>
<li class="chapter" data-level="5.1.8" data-path="eda.html"><a href="eda.html#quejas-según-tipo-de-quejas"><i class="fa fa-check"></i><b>5.1.8</b> Quejas según tipo de quejas</a></li>
<li class="chapter" data-level="5.1.9" data-path="eda.html"><a href="eda.html#ruido-bigcup-nypd"><i class="fa fa-check"></i><b>5.1.9</b> Ruido <span class="math inline">\(\bigcup\)</span> NYPD</a></li>
<li class="chapter" data-level="5.1.10" data-path="eda.html"><a href="eda.html#quejas-por-año"><i class="fa fa-check"></i><b>5.1.10</b> Quejas por año</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="eda.html"><a href="eda.html#clean-1"><i class="fa fa-check"></i><b>5.2</b> Clean</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="modelos.html"><a href="modelos.html"><i class="fa fa-check"></i><b>6</b> Modelos</a>
<ul>
<li class="chapter" data-level="6.1" data-path="modelos.html"><a href="modelos.html#feature-engineering"><i class="fa fa-check"></i><b>6.1</b> Feature engineering</a></li>
<li class="chapter" data-level="6.2" data-path="modelos.html"><a href="modelos.html#tuneo-de-hiperparámetros"><i class="fa fa-check"></i><b>6.2</b> Tuneo de hiperparámetros</a></li>
<li class="chapter" data-level="6.3" data-path="modelos.html"><a href="modelos.html#selección-de-modelos"><i class="fa fa-check"></i><b>6.3</b> Selección de Modelos</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="metricas.html"><a href="metricas.html"><i class="fa fa-check"></i><b>7</b> Métricas de Desempeño</a></li>
<li class="chapter" data-level="8" data-path="continuos-integration.html"><a href="continuos-integration.html"><i class="fa fa-check"></i><b>8</b> Continuous integration CI</a>
<ul>
<li class="chapter" data-level="8.1" data-path="continuos-integration.html"><a href="continuos-integration.html#pruebas-de-código"><i class="fa fa-check"></i><b>8.1</b> Pruebas de código</a></li>
<li class="chapter" data-level="8.2" data-path="continuos-integration.html"><a href="continuos-integration.html#tipos-de-pruebas"><i class="fa fa-check"></i><b>8.2</b> Tipos de pruebas</a></li>
<li class="chapter" data-level="8.3" data-path="continuos-integration.html"><a href="continuos-integration.html#pruebas-unitarias"><i class="fa fa-check"></i><b>8.3</b> Pruebas unitarias</a></li>
<li class="chapter" data-level="8.4" data-path="continuos-integration.html"><a href="continuos-integration.html#unittest"><i class="fa fa-check"></i><b>8.4</b> Unittest</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="continuos-integration.html"><a href="continuos-integration.html#asserts"><i class="fa fa-check"></i><b>8.4.1</b> Asserts</a></li>
<li class="chapter" data-level="8.4.2" data-path="continuos-integration.html"><a href="continuos-integration.html#fixtures"><i class="fa fa-check"></i><b>8.4.2</b> Fixtures</a></li>
<li class="chapter" data-level="8.4.3" data-path="continuos-integration.html"><a href="continuos-integration.html#mocks"><i class="fa fa-check"></i><b>8.4.3</b> Mocks</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="continuos-integration.html"><a href="continuos-integration.html#unit-test-para-dsml"><i class="fa fa-check"></i><b>8.5</b> Unit test para DS/ML</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="biasFairness.html"><a href="biasFairness.html"><i class="fa fa-check"></i><b>9</b> Bias y Fairness</a>
<ul>
<li class="chapter" data-level="9.1" data-path="biasFairness.html"><a href="biasFairness.html#aequitas"><i class="fa fa-check"></i><b>9.1</b> Aequitas</a></li>
<li class="chapter" data-level="9.2" data-path="biasFairness.html"><a href="biasFairness.html#aifairness360-aif360"><i class="fa fa-check"></i><b>9.2</b> AIFairness360 (AIF360)</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="solucion.html"><a href="solucion.html"><i class="fa fa-check"></i><b>10</b> Solución Propuesta: Producto Final</a></li>
<li class="chapter" data-level="11" data-path="orquestacion.html"><a href="orquestacion.html"><i class="fa fa-check"></i><b>11</b> Orquestación del flujo de trabajo</a>
<ul>
<li class="chapter" data-level="11.1" data-path="orquestacion.html"><a href="orquestacion.html#tasks"><i class="fa fa-check"></i><b>11.1</b> Tasks</a></li>
<li class="chapter" data-level="11.2" data-path="orquestacion.html"><a href="orquestacion.html#dag"><i class="fa fa-check"></i><b>11.2</b> DAG</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="conclusiones.html"><a href="conclusiones.html"><i class="fa fa-check"></i><b>12</b> Conclusiones</a></li>
<li class="chapter" data-level="13" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i><b>13</b> Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NYC 311 Service Request Data Product</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="infra" class="section level1" number="3">
<h1><span class="header-section-number">Capítulo 3</span> Data Pipeline e Infraestructura de AWS</h1>
<div id="data-pipeline" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Data Pipeline</h2>
<div id="deployment" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Deployment</h3>
<strong>Gráfica 2.Data Product Pipeline: Deployment</strong>
<div align="center">
<p><image width="700" height="100" src="./images/deployment.png"></p>
</div>
<ol style="list-style-type: decimal">
<li>Script en python que hace peticiones a la API de <strong>socrata</strong> usando la librería <strong>sodapy</strong> solicitando todos los registros de la base de datos en formato JSON.</li>
<li>En la EC2 se recibe el archivo de datos y se guarda en la instancia S3. El script hace las predicciones por fecha y los archivos respuesta se van guardando en una estructura de carpetas dentro de S3. El S3 está encriptado de tal manera que solamente pueden ingresar con las credenciales asignadas.</li>
<li>Alimentamos el esquema <strong>preprocessed</strong> en el cual se genera la misma estructura de carpetas y los archivos JSON se guardan en formato parquet.</li>
<li>Se genera el esquema <strong>cleaned</strong> a partir del esquema preprocessed. En este esquema se eliminan las columnas que no tienen variabilidad o son en su mayoría valores nulos. Se asignan los tipos de dato a cada columna y se limpian acentos y caracteres extraños de nombres de columnas y observaciones. Se conserva el formato parquet.</li>
</ol>
<p>Los detalles de la configuración y uso de la arquitura utilizada en AWS se encuenta en <a href="https://github.com/dapivei/data-product-architecture-final-project/tree/master/scripts/conf-AWS" title="aws configuración">scripts aws</a></p>
</div>
<div id="desarrollo" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Desarrollo</h3>
<p><strong>Gráfica 3.Data Product Pipeline: Desarrollo y Producción</strong></p>
<div align="center">
<p><image width="700" height="100" src="./images/desarrollo_produccion.png"></p>
</div>
<div id="extract" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Extract</h4>
<ol style="list-style-type: decimal">
<li>Hacemos una petición a la API solicitando los datos en formato JSON por medio de un script en python. Se hará un petición al día en la que filtramos para incluir solamente los registros que se crearon el día anterior (registros nuevos). La petición actualmente se hace por número de registros. Se modificará para realizar un filtrado utilizando la variable <strong>created_date</strong>.</li>
<li>Hacemos una segunda petición a la API solicitando los registros que se cerraron el día anterior en formato JSON. Filtramos la petición por medio de las variables <strong>closed_date</strong> (actualización de registros existentes).</li>
</ol>
</div>
<div id="load" class="section level4" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Load</h4>
<ol style="list-style-type: decimal">
<li>La petición de los datos en <em>extract</em> nos permite obtener los archivos JSON de la API, uno por cada petición y los registros nuevos se incorporan a la estructura de carpetas en S3 con la fecha de creación del registro (futura estructura). Los registros obtenidos por la variable closed_date se guardan en otra estructura de carpatas generada a partir de las fechas.</li>
</ol>
</div>
<div id="transform" class="section level4" number="3.1.2.3">
<h4><span class="header-section-number">3.1.2.3</span> Transform</h4>
<ol style="list-style-type: decimal">
<li>Se corre un script en python (pyspark) que hace consultas a los datos almacenados en parquet, se limpian los datos, se quitan las columnas nulas o que no tienen variabilidad y incorporan los registros al esquema cleaned de la estructura de carpetas.<br />
</li>
<li>Se corre un segundo script en python que transforma el archivo JSON que tiene la actualización de registros existentes a parquet, se lleva al formato cleaned y es guarda en la estructura de carpetas.</li>
</ol>
<p><strong>Gráfica 4.Extract, Load &amp; Transform</strong></p>
<div align="center">
<p><image width="700" height="500" src="./images/elt_aws.png"></p>
</div>
</div>
</div>
</div>
<div id="infraestructura-aws" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Infraestructura AWS</h2>
<p><em>Nota</em>: Los scripts asociados a este apartado se encuentran en el archivo <a href="https://github.com/dapivei/data-product-architecture-final-project/tree/master/scripts/conf-AWS">conf-AWS</a>.</p>
<div id="configuración-del-bastión" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Configuración del bastión</h3>
<p>El bastión es una instancia pequeña <code>t2.micro</code> con <code>8gb</code> de memoria (no es necesario tener algo con mayor capacidad en este punto). Funciona como punto de seguridad y administra a los usuarios para que puedan entrar a la arquitectura de AWS.</p>
<p>Este <code>ec2</code> vive dentro de una subnet pública en una VPC.</p>
<p>Para tener la conexión al bastión, ocupamos el protocolo <code>ssh</code> como sigue:</p>
<pre><code>ssh -o &quot;ServerAliveInterval 60&quot; -i /ruta/llave.pem  ubuntu@ip-ec2</code></pre>
<p>Para salir, basta con poner <code>exit</code> en el shell de la instancia.</p>
</div>
<div id="addus.sh" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> addus.sh</h3>
<p>Este script crea los usuarios dentro del bastión y asigna la misma contraseña a cada uno de ellos, por lo que debemos estar conectados a la instancia. Para poder hacer uso es necesario darle los permisos, es decir, <code>chmod +x addus.sh</code>. También es importante mencionar que se utiliza un archivo txt <code>users.txt</code> que contiene el nombre de los usuarios que queremos agregar.</p>
<p>Para la selección de contraseña, utilizamos el encriptador <code>crypt</code> contenido en python 3.6.5 usando los siguientes comandos:</p>
<pre><code>import crypt
crypt.crypt(&quot;contraseña&quot;,&quot;salt&quot;)</code></pre>
<p>La salida de estos comandos debe verse como: <code>'sa1O7Z1pCJzK.'</code>; esta debe agregarse al script <code>addus.ssh</code> en la parte indicada. Para correr el archivo solo es necesario correr el siguiente comando:</p>
<pre><code>./addus.sh</code></pre>
<p>En este punto ya tenemos a los usuarios agregados: todos con la misma contraseña y permisos de super usuario.</p>
</div>
<div id="agregar-llaves-para-conexión" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Agregar llaves para conexión</h3>
<p>Una vez creados los usuarios, copiaremos las llaves públicas de cada uno de los usuarios a su usuario correspondiente.</p>
<ol style="list-style-type: decimal">
<li>Es necesario modificar el archivo <code>sudo nano /etc/ssh/sshd_config</code> y cambiar los parámetros a la siguiente configuración:</li>
</ol>
<pre><code>PubkeyAuthentication yes
PubkeyAuthentication yes</code></pre>
<p>Ahora solo es necesario reiniciar el servicio sshd con el comando:</p>
<pre><code>sudo service sshd restart
</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Realizar el copiado de las llaves al bastión, de forma segura:</li>
</ol>
<pre><code>ssh-copy-id -f -i /ruta/llave/id_llave.pub usuario@ip-ec2</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Finalmente, nos reconectamos al bastión y cambiamos la configuración del archivo <code>sudo nano /etc/ssh/sshd_config</code> dejando el siguiente parámetro:</li>
</ol>
<pre><code>PasswordAuthentication no</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Reiniciamos el servicio <code>sudo service sshd restart</code></li>
</ol>
<p>Para conectarnos usando el protocolo <code>ssh</code> y la llave privada, utilizamos el siguiente comando:</p>
<pre><code>ssh -o &quot;ServerAliveInterval 60&quot; -i /ruta/llave_privada  usuario@ip-ec2</code></pre>
</div>
<div id="ec2-procesamiento" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> EC2 procesamiento</h3>
<p>Esta máquina es para el procesamiento de la información y es donde viven las tareas que realiza <code>luigi</code>; cabe mencionar que esta instancia es de mayor capacidad. Aquí también debe ser instalado <code>docker</code> para la reproducibilidad del proyecto.</p>
<p>Esta maquina vive dentro de una VPC con una subnet privada. Para tener acceso a la misma tenemos que hacer un secure copy de la llave.pem al bastion:</p>
<pre><code>ssh -i  /tu/ruta/llave-bastion.pem /tu/ruta/llave/ec2/llave.pem ubuntu@ip-ec2:/home/ubuntu/.ssh</code></pre>
<p>Nos conectamos al bastión y en la ruta <code>/home/ubuntu/.ssh</code> tendremos guardada la <code>llave.pem</code>. En este punto solo tendremos que hacer la conexión usando el protocolo <code>ssh</code>.</p>
<p>Para asegurar el correcto funcionamiento del host de luigi se debe habilitar el puerto <code>8082</code>. La conexión se realiza usando el siguiente comando en la EC2</p>
<pre><code>luigid</code></pre>
<p>Esto activa el puerto <code>8082</code> y permite que nos conectemos usando el navegador de internet en la siguiente liga</p>
<pre><code>ip_ec2:8082</code></pre>
<p>Nota: si falla la conexión a la EC2 y por alguna razón no permite entrar a la liga debemos usar el siguiente comando <code>sudo lsof -t -i tcp:8082 | xargs kill -9</code> esto termina la conexión previa y así podemos reiniciar.</p>
</div>
<div id="para-levantar-cluster" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Para levantar cluster</h3>
<p>A continuación se presentan los pasos a seguir para configurar y levantar el cluster, conexión y trabajo dentro del mismo. Para el óptimo desarrollo se tiene como consideración que los datos se encuentran guardados en una <code>S3</code>.</p>
<p>Conectado en el servicio <code>EMR</code> de <code>AWS</code>, damos click en el botón <code>crear cluster</code>. Nombramos el cluster; en configuración de software escogemos <code>emr-5.29.0</code> con aplicaciones <code>Spark: Spark 2.4.4 on Hadoop 2.8.5 YARN with Ganglia 3.7.2 and Zeppelin 0.8.2</code> y finalmente seleccionamos <code>crear cluster</code></p>
<p>Para la conexión al cluster es recomendable utilizar el explorador <code>chrome</code>. En el explorador abrimos la siguiente <a href="https://chrome.google.com/webstore/detail/foxyproxy-standard/gcknhkkoolaabfmlnjonogaaifnjlfnp?hl=es" title="complemento FoxyProxy">liga</a> para instalar el complemento <code>FoxyProxy Standard</code>, dentro de este complemento en <code>options &gt; import/export</code> subimos el archivo <code>foxyproxy-settings.xml</code>, por último en <code>proxy mode</code> seleccionamos la opción <code>Use proxies based on their pre-defined patterns and priorities</code></p>
<ul>
<li>Abrimos el tunel <code>ssh</code> desde la linea de comandos de la siguiente forma.</li>
</ul>
<pre><code>ssh -i ~/ruta/llave.pem -ND 8157 hadoop@dns_ip_aws</code></pre>
<ul>
<li>Desde <code>chrome</code> nos conectamos a la siguiente ruta para utilizar <code>Zeppelin</code>.</li>
</ul>
<pre><code>dns_ip_aws:8890</code></pre>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dataset.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="governanza.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dapivei/prueba02-infra.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["NYC311ServiceRequest.pdf", "NYC311ServiceRequest.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
